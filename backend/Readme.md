# 智能相册系统架构设计文档

## 架构概述

智能相册系统采用了多层架构设计，具体包括前端客户端层、控制器层、服务层、数据访问层和数据存储层，此外集成了python写的外部AI服务。这种分层架构有利于代码的组织和维护，同时保证了系统的可扩展性和灵活性。

### 1. 前端客户端层

前端客户端层负责与用户进行交互，通过接入后端的接口，将用户操作转换为对后端API的调用。

### 2. 控制器层（Controllers）

控制器层是系统的入口点，负责接收和响应HTTP请求，包含了大部分数据库中数据表的实体的接口。

控制器层使用JWT进行身份验证，并通过ThreadLocal存储用户信息，实现请求上下文的传递。

### 3. 服务层（Services）

服务层包含业务逻辑，为控制器层提供方法。

### 4. 数据访问层（Mappers）

数据访问层负责与数据库的交互，项目使用MyBatis-Plus框架简化数据库操作。

### 5. 数据存储层（sql）

系统使用PostgreSQL数据库存储结构化数据，数据模型设计见album.sql文件。

### 6. 外部AI服务

系统集成了基于Flask的Python AI服务，通过网址访问调用接口，用于ai识别，照片到视频的转换，视频字幕添加等内容

## 数据流

1. 用户通过前端界面进行操作（如上传照片）
2. 请求首先到达控制器层，控制器验证身份并解析请求
3. 控制器调用相应的服务层组件处理业务逻辑
4. 服务层可能调用数据访问层进行数据操作或调用外部AI服务进行处理
5. 数据访问层与数据库交互，存储或检索数据
6. 结果通过各层传回给前端展示

## 关键技术与特性

1. **认证与授权**：使用JWT（JSON Web Token）机制进行用户认证和授权
2. **ORM框架**：使用MyBatis-Plus简化数据库操作
3. **分层架构**：严格的分层设计使系统易于维护和扩展
4. **微服务集成**：通过HTTP集成外部Flask AI服务，实现功能解耦
5. **数据验证**：使用Java Validation API进行数据验证
6. **日志记录**：使用SLF4J进行全系统日志记录

## 未来扩展可能

1. **扩展AI功能**：增强照片分析、自动分类和推荐功能
2. **负载均衡**：引入负载均衡机制处理高并发请求
3. **CDN集成**：使用CDN加速照片和视频的分发
4. **加密存储与传输**：储存以及传输加密，保证用户隐私

## 架构设计决策与考量

1. **为什么选择分层架构？**
    - 分离关注点，使代码更易于理解和维护
    - 便于团队协作，不同开发人员可以专注于不同层次

2. **为什么将AI功能分离为独立服务？**
    - 允许使用Python生态系统中强大的AI和视频处理库
    - 解耦系统，使主系统和AI处理可以独立扩展和优化

3. **为什么使用JWT进行认证？**
    - 无状态认证机制，适合分布式系统
    - 降低服务器负担，减少数据库查询

4. **为什么选择PostgreSQL数据库？**
    - 支持复杂查询和数据类型（如数组类型）
    - 良好的性能和可靠性
    - 对JSON数据的原生支持，适合存储和查询半结构化数据